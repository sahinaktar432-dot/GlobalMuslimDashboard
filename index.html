<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Al-Alsa | Global Ummah</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@700&family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-font-smoothing: antialiased; -webkit-tap-highlight-color: transparent; }
        :root { --emerald: #043927; --gold: #c5a021; --bg: #f2f2f7; --white: #ffffff; }
        
        body { font-family: 'Inter', -apple-system, sans-serif; background: var(--bg); color: #121212; line-height: 1.25; overflow-x: hidden; }

        nav { background: var(--emerald) ; padding: 14px 20px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .logo { font-weight: 900; font-size: 1.4rem; letter-spacing: -1.2px; color: var(--gold); }

        /* UPGRADED ANIMATED PANELS */
        #fullMenu, #surahPanel, #quizPanel, #tasbihPanel, #aiTutorPanel {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--emerald); z-index: 5000; display: none; flex-direction: column;
            overflow-y: auto; padding: 40px 20px;
            opacity: 0; transform: translateY(30px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .panel-active { display: flex !important; opacity: 1 !important; transform: translateY(0) !important; }

        /* PREMIUM HUB STYLES */
        .hub-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); z-index: 8000;
            display: none; align-items: flex-end; justify-content: center;
        }
        .hub-container {
            background: white; width: 100%; max-width: 500px;
            border-top-left-radius: 32px; border-top-right-radius: 32px;
            padding: 30px 20px; animation: slideUp 0.4s cubic-bezier(0, 0, 0.2, 1);
        }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .hub-card {
            display: flex; align-items: center; gap: 15px;
            padding: 18px; border-radius: 20px; border: 2px solid #f0f0f5;
            margin-bottom: 12px; cursor: pointer; transition: 0.2s;
        }
        .hub-card i { font-size: 1.8rem; width: 40px; text-align: center; color: var(--emerald); }
        .hub-card.active { border-color: #34c759; background: #f2fff5; }
        .hub-card h3 { font-size: 1.1rem; font-weight: 900; color: #1c1c1e; }
        .hub-card p { font-size: 0.8rem; color: #8e8e93; font-weight: 600; }
        .start-learning-btn {
            width: 100%; background: var(--emerald); color: white; border: none;
            padding: 18px; border-radius: 20px; font-size: 1.1rem;
            font-weight: 900; margin-top: 15px; cursor: pointer;
        }

        /* AI TUTOR PANEL SPECIFICS */
        #chatContainer { flex: 1; overflow-y: auto; padding: 10px; display: flex; flex-direction: column; gap: 12px; margin-top: 20px; }
        .message { max-width: 85%; padding: 12px 16px; border-radius: 18px; font-size: 0.95rem; font-weight: 600; }
        .msg-ai { align-self: flex-start; background: rgba(255,255,255,0.1); color: white; border-bottom-left-radius: 4px; }
        .msg-user { align-self: flex-end; background: var(--gold); color: var(--emerald); border-bottom-right-radius: 4px; }
        .chat-input-area { display: flex; gap: 10px; padding: 20px 0; }
        #userInput { flex: 1; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); padding: 15px; border-radius: 15px; color: white; outline: none; }
        .send-btn { background: var(--gold); border: none; width: 50px; border-radius: 15px; color: var(--emerald); cursor: pointer; }

        /* REST OF YOUR STYLES */
        .menu-item { color: white; text-decoration: none; font-size: 1.6rem; margin: 15px 0; font-weight: 900; cursor: pointer; text-align: center; transition: 0.2s; }
        .menu-item:active { transform: scale(0.95); opacity: 0.8; }
        #loginBtn { background: white; color: #444; padding: 16px; border-radius: 20px; font-size: 1.1rem; box-shadow: 0 4px 15px rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 25px; border: none; width: 100%; }
        #loginBtn i { color: #4285F4; font-size: 1.3rem; }
        .close-btn { position: absolute; top: 20px; right: 30px; color: white; font-size: 2.5rem; cursor: pointer; z-index: 6000; }
        .hero { background: linear-gradient(180deg, var(--emerald) 0%, #0a5c41 100%); color: white; padding: 40px 20px; text-align: center; border-bottom-left-radius: 40px; border-bottom-right-radius: 40px; }
        .timer-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 25px; }
        .timer-card { background: rgba(255,255,255,0.1); padding: 15px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(5px); }
        .timer-card b { font-size: 1.1rem; color: var(--gold); display: block; font-weight: 900; margin-top: 5px; }
        .container { padding: 20px; max-width: 650px; margin: 0 auto; margin-top: -30px; }
        section { background: var(--white); padding: 25px; border-radius: 28px; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.06); }
        h2 { font-size: 1.3rem; font-weight: 900; color: var(--emerald); margin-bottom: 15px; letter-spacing: -0.5px; }
        .mission-btn, .quiz-opt { width: 100%; padding: 18px; margin-bottom: 12px; border-radius: 20px; border: 1px solid #eee; background: #f8f9fb; font-weight: 900; color: var(--emerald); display: flex; justify-content: space-between; align-items: center; cursor: pointer; transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .mission-btn.done { background: #34c759 !important; color: white !important; border-color: #34c759; }
        .names-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .name-box { background: #f8f9fa; padding: 12px; border-radius: 15px; border: 1px solid #eee; text-align: center; }
        .name-box .ar { font-family: 'Amiri'; font-size: 1.4rem; color: var(--emerald); display: block; }
        .name-box .en { font-size: 0.75rem; font-weight: 800; color: var(--gold); text-transform: uppercase; }
        .quote-scroll { height: 350px; overflow-y: auto; padding-right: 5px; }
        .q-card { padding: 15px 0; border-bottom: 1px solid #eee; }
        .q-card p { font-size: 0.9rem; font-weight: 700; color: #333; margin-bottom: 5px; }
        .q-card span { font-size: 0.75rem; color: var(--gold); font-weight: 800; }
        #coinFeedback { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 3rem; font-weight: 900; color: var(--gold); z-index: 7000; pointer-events: none; opacity: 0; }
        .animate-coin { animation: coinPop 0.8s ease-out forwards; }
        @keyframes coinPop { 0% { opacity: 0; transform: translate(-50%, 0); } 50% { opacity: 1; transform: translate(-50%, -100px); } 100% { opacity: 0; transform: translate(-50%, -150px); } }
        .surah-card { background: rgba(255,255,255,0.08); padding: 18px; border-radius: 22px; margin-bottom: 12px; color: white; border: 1px solid rgba(255,255,255,0.1); }
        .surah-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .surah-name-ar { font-family: 'Amiri'; font-size: 1.2rem; color: var(--gold); }
        audio { width: 100%; height: 35px; margin-top: 10px; filter: invert(1) hue-rotate(180deg); opacity: 0.8; }
        .social-links { display: flex; justify-content: center; gap: 20px; margin-top: 15px; }
        .social-links a { color: var(--emerald); text-decoration: none; font-size: 1.2rem; }
        .prayer-times-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 15px; }
        .p-time-box { background: #f8f9fa; padding: 10px; border-radius: 12px; text-align: center; border: 1px solid #eee; }
        .p-time-box span { display: block; font-size: 0.7rem; font-weight: 800; color: var(--gold); }
        .p-time-box b { font-size: 0.9rem; color: var(--emerald); }
        .tasbih-circle { width: 240px; height: 240px; border: 12px solid var(--gold); border-radius: 50%; margin: 40px auto; display: flex; align-items: center; justify-content: center; font-size: 4rem; color: white; font-weight: 900; cursor: pointer; transition: transform 0.1s ease; box-shadow: 0 15px 35px rgba(0,0,0,0.2); background: rgba(255, 255, 255, 0.05); user-select: none; }
        .tasbih-circle:active { transform: scale(0.92); }
        .leaderboard-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .leaderboard-table tr { border-bottom: 1px solid #eee; }
        .leaderboard-table td { padding: 12px 5px; font-size: 0.9rem; font-weight: 700; }
        .rank { color: var(--gold); width: 35px; font-weight: 900; }
    </style>
</head>
<body>

    <div id="coinFeedback">+1 ü™ô</div>

    <nav>
        <div class="logo">AL-ALSA</div>
        <div style="display: flex; gap: 15px; align-items: center;">
            <div style="font-weight: 900; background: var(--gold); padding: 5px 12px; border-radius: 12px; font-size: 0.9rem;">ü™ô <span id="coinCount">0</span></div>
            <div onclick="toggleMenu()" style="color:white; cursor:pointer;"><i class="fas fa-bars-staggered" style="font-size: 1.5rem;"></i></div>
        </div>
    </nav>

    <div id="premiumHub" class="hub-overlay" onclick="closeHub()">
        <div class="hub-container" onclick="event.stopPropagation()">
            <h2 style="color: #1c1c1e; margin-bottom: 20px; text-align: center;">Choose Learning Mode</h2>
            <div class="hub-card" id="card-ai" onclick="selectHubMode('ai')">
                <i class="fas fa-microchip"></i>
                <div>
                    <h3>AI Tutor</h3>
                    <p>Ask anything about Islam & Quran</p>
                </div>
            </div>
            <div class="hub-card active" id="card-memorise" onclick="selectHubMode('memorise')">
                <i class="fas fa-brain"></i>
                <div>
                    <h3>Memorise</h3>
                    <p>Practice with active recall quizzes</p>
                </div>
            </div>
            <div class="hub-card" id="card-challenge" onclick="selectHubMode('challenge')">
                <i class="fas fa-trophy"></i>
                <div>
                    <h3>Challenge</h3>
                    <p>Compete for the Global Leaderboard</p>
                </div>
            </div>
            <button class="start-learning-btn" onclick="executeHubStart()">Start learning</button>
        </div>
    </div>

    <div id="fullMenu">
        <div class="close-btn" onclick="toggleMenu()">√ó</div>
        <div id="userNameDisplay" style="color: var(--gold); font-size: 1.2rem; font-weight: 900; margin-bottom: 20px; text-align: center; text-transform: uppercase;"></div>
        <div class="menu-item" id="loginBtn" onclick="handleGoogleLogin()"><i class="fab fa-google"></i> GOOGLE LOGIN</div>
        <div class="menu-item" id="logoutBtn" onclick="handleLogout()" style="display:none; color: #ff3b30;"><i class="fas fa-sign-out-alt"></i> LOGOUT</div>
        <div class="menu-item" onclick="openTasbih()"><i class="fas fa-fingerprint"></i> DIGITAL TASBIH</div>
        <div class="menu-item" onclick="openSurahs()">üéß LISTEN SURAH</div>
        <div class="menu-item" onclick="openLearningHub()"><i class="fas fa-star"></i> LEARNING HUB</div>
        <a href="#names" class="menu-item" onclick="toggleMenu()">99 NAMES</a>
        <a href="#quotes" class="menu-item" onclick="toggleMenu()">100 WISDOMS</a>
    </div>

    <div id="aiTutorPanel">
        <div class="close-btn" onclick="closeAiTutor()">√ó</div>
        <h2 style="color: var(--gold); text-align: center;">AI Quran Tutor</h2>
        <div id="chatContainer"></div>
        <div class="chat-input-area">
            <input type="text" id="userInput" placeholder="Ask about Islam..." onkeypress="if(event.key === 'Enter') sendAiMessage()">
            <button class="send-btn" onclick="sendAiMessage()"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <div id="surahPanel">
        <div class="close-btn" onclick="closeSurahs()">√ó</div>
        <h2 style="color: var(--gold); text-align: center; margin-bottom: 20px;">Noble Quran (50 Surahs)</h2>
        <div id="surahList"></div>
    </div>

    <div id="quizPanel">
        <div class="close-btn" onclick="closeQuiz()">√ó</div>
        <h2 style="color: var(--gold); text-align: center;">Quiz Challenge</h2>
        <div id="quizContent" style="margin-top: 30px;">
            <p id="questionText" style="color:white; font-size:1.3rem; font-weight:800; margin-bottom:20px; text-align:center;"></p>
            <div id="optionsContainer"></div>
        </div>
    </div>

    <div id="tasbihPanel">
        <div class="close-btn" onclick="closeTasbih()">√ó</div>
        <h2 style="color: var(--gold); text-align: center;">Digital Tasbih</h2>
        <p style="color: white; text-align: center; opacity: 0.8; margin-top: 10px;">Tap circle to count. Earn 1 coin per 33 Dhikr.</p>
        <div class="tasbih-circle" onclick="countTasbih()" id="tasbihDisplay">0</div>
        <button class="mission-btn" style="width: 150px; margin: 0 auto; background: var(--white); color: var(--emerald); justify-content: center;" onclick="resetTasbih()">RESET</button>
    </div>

    <div class="hero">
        <h1 style="font-family: 'Amiri'; font-size: 2.5rem; color: var(--gold);">ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸáŸê</h1>
        <p style="font-weight: 900; text-transform: uppercase;">Global Muslim Dashboard</p>
        <div class="timer-row">
            <div class="timer-card"><small>RAMADAN 2026</small><b id="ramadan">--d --h</b></div>
            <div class="timer-card"><small>JUMMAH PRAYER</small><b id="jummah">--d --h</b></div>
        </div>
    </div>

    <div class="container">
        <section id="prayer-section">
            <h2 id="locationLabel">Prayer Times (Loading...)</h2>
            <div class="prayer-times-grid">
                <div class="p-time-box"><span>FAJR</span><b id="t-fajr">--:--</b></div>
                <div class="p-time-box"><span>DHUHR</span><b id="t-dhuhr">--:--</b></div>
                <div class="p-time-box"><span>ASR</span><b id="t-asr">--:--</b></div>
                <div class="p-time-box"><span>MAGHRIB</span><b id="t-maghrib">--:--</b></div>
                <div class="p-time-box"><span>ISHA</span><b id="t-isha">--:--</b></div>
                <div class="p-time-box"><span>SUNRISE</span><b id="t-sunrise">--:--</b></div>
            </div>
        </section>

        <section id="missions">
            <h2>Daily Salah Tracker</h2>
            <button class="mission-btn" id="salah-fajr" onclick="completeSalah('fajr', this)">FAJR <span>+1 ü™ô</span></button>
            <button class="mission-btn" id="salah-dhuhr" onclick="completeSalah('dhuhr', this)">DHUHR <span>+1 ü™ô</span></button>
            <button class="mission-btn" id="salah-asr" onclick="completeSalah('asr', this)">ASR <span>+1 ü™ô</span></button>
            <button class="mission-btn" id="salah-maghrib" onclick="completeSalah('maghrib', this)">MAGHRIB <span>+1 ü™ô</span></button>
            <button class="mission-btn" id="salah-isha" onclick="completeSalah('isha', this)">ISHA <span>+1 ü™ô</span></button>
        </section>

        <section id="leaderboard">
            <h2>Global Ummah Leaders (Top 10)</h2>
            <table class="leaderboard-table" id="leaderboardBody"></table>
        </section>

        <section id="names">
            <h2>99 Names of Allah</h2>
            <div class="names-grid" id="namesGrid"></div>
        </section>

        <section id="quotes">
            <h2>100 Wisdoms & Verses</h2>
            <div class="quote-scroll" id="quoteList"></div>
        </section>
    </div>

    <footer style="text-align: center; padding: 40px 20px; border-top: 1px solid #eee;">
        <h2 style="color:var(--emerald)">AL-ALSA</h2>
        <p style="font-size: 0.8rem; font-weight: 800; opacity: 0.5; margin-bottom: 10px;">SHAHIN AKTAR ‚Ä¢ STUDENT DEVELOPER & EDITOR ‚Ä¢ 2026</p>
    </footer>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCUQblrFn3RHyy4sxqhA2Hz7Nq4gYosZT0",
            authDomain: "al-alsa.firebaseapp.com",
            databaseURL: "https://al-alsa-default-rtdb.firebaseio.com/",
            projectId: "al-alsa",
            storageBucket: "al-alsa.firebasestorage.app",
            messagingSenderId: "511589143545",
            appId: "1:511589143545:web:a3d4f7ec90afbda4cf2328",
            measurementId: "G-JL8FD6D6FF"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        let userData = JSON.parse(localStorage.getItem('alsa_v10')) || { coins: 0, lastClaimDate: "", claimedSalah: [], tasbih: 0 };
        let currentHubMode = 'memorise';

        // AI KNOWLEDGE BASE
        const IslamicAI = {
            "salam": "Walaikum Assalam! May the peace and blessings of Allah be upon you. How can I help you learn today?",
            "zakat": "Zakat is the 3rd pillar of Islam, requiring 2.5% of savings to be given to the needy annually.",
            "prayer": "Salah is the 2nd pillar. It keeps us connected to our Creator 5 times a day.",
            "quran": "The Noble Quran is the final revelation from Allah to Prophet Muhammad (PBUH).",
            "default": "SubhanAllah, that is a great question! I am still learning, but as a tutor, I recommend checking a Sahih source or asking a local scholar for deep fatwas. Can I help with something simpler?"
        };

        // PREMIUM HUB LOGIC
        function openLearningHub() { toggleMenu(); document.getElementById('premiumHub').style.display = 'flex'; }
        function closeHub() { document.getElementById('premiumHub').style.display = 'none'; }
        
        function selectHubMode(mode) {
            currentHubMode = mode;
            document.querySelectorAll('.hub-card').forEach(c => c.classList.remove('active'));
            document.getElementById('card-'+mode).classList.add('active');
            if(navigator.vibrate) navigator.vibrate(10);
        }

        function executeHubStart() {
            closeHub();
            if(currentHubMode === 'ai') openAiTutor();
            else if(currentHubMode === 'memorise') openQuiz();
            else window.location.hash = "#leaderboard";
        }

        // AI TUTOR LOGIC
        function openAiTutor() {
            const p = document.getElementById('aiTutorPanel');
            p.style.display = 'flex';
            setTimeout(() => p.classList.add('panel-active'), 10);
            const container = document.getElementById('chatContainer');
            container.innerHTML = `<div class="message msg-ai">Assalamu Alaikum! I am your AL-ALSA Tutor. Ask me about Zakat, Prayer, or the Quran.</div>`;
        }
        function closeAiTutor() {
            const p = document.getElementById('aiTutorPanel');
            p.classList.remove('panel-active');
            setTimeout(() => p.style.display = 'none', 400);
        }
        function sendAiMessage() {
            const input = document.getElementById('userInput');
            const txt = input.value.trim().toLowerCase();
            if(!txt) return;
            appendMsg(input.value, 'msg-user');
            input.value = "";
            setTimeout(() => {
                let reply = IslamicAI["default"];
                for(let key in IslamicAI) { if(txt.includes(key)) reply = IslamicAI[key]; }
                appendMsg(reply, 'msg-ai');
            }, 600);
        }
        function appendMsg(text, cls) {
            const div = document.createElement('div');
            div.className = 'message ' + cls;
            div.innerText = text;
            const c = document.getElementById('chatContainer');
            c.appendChild(div);
            c.scrollTop = c.scrollHeight;
        }

        // --- REST OF YOUR ORIGINAL FUNCTIONS ---
        const surahNames = ["Al-Fatihah", "Al-Baqarah", "Ali 'Imran", "An-Nisa'", "Al-Ma'idah", "Al-An'am", "Al-A'raf", "Al-Anfal", "At-Tawbah", "Yunus", "Hud", "Yusuf", "Ar-Ra'd", "Ibrahim", "Al-Hijr", "An-Nahl", "Al-Isra'", "Al-Kahf", "Maryam", "Ta-Ha", "Al-Anbiya'", "Al-Hajj", "Al-Mu'minun", "An-Nur", "Al-Furqan", "Ash-Shu'ara'", "An-Naml", "Al-Qasas", "Al-'Ankabut", "Ar-Rum", "Luqman", "As-Sajdah", "Al-Ahzab", "Saba'", "Fatir", "Ya-Sin", "As-Saffat", "Sad", "Az-Zumar", "Ghafir", "Fussilat", "Ash-Shura", "Az-Zukhruf", "Ad-Dukhan", "Al-Jathiyah", "Al-Ahqaf", "Muhammad", "Al-Fath", "Al-Hujurat", "Qaf"];
        const allahNames = [{ar:"ÿßŸÑŸÑŸá", en:"Allah"}, {ar:"ÿßŸÑÿ±ÿ≠ŸÖŸÜ", en:"Ar-Rahman"}, {ar:"ÿßŸÑÿ±ÿ≠ŸäŸÖ", en:"Ar-Rahim"}, {ar:"ÿßŸÑŸÖŸÑŸÉ", en:"Al-Malik"}, {ar:"ÿßŸÑŸÇÿØŸàÿ≥", en:"Al-Quddus"}, {ar:"ÿßŸÑÿ≥ŸÑÿßŸÖ", en:"As-Salam"}, {ar:"ÿßŸÑŸÖÿ§ŸÖŸÜ", en:"Al-Mu'min"}, {ar:"ÿßŸÑŸÖŸáŸäŸÖŸÜ", en:"Al-Muhaymin"}, {ar:"ÿßŸÑÿπÿ≤Ÿäÿ≤", en:"Al-Aziz"}, {ar:"ÿßŸÑÿ¨ÿ®ÿßÿ±", en:"Al-Jabbar"}, {ar:"ÿßŸÑŸÖÿ™ŸÉÿ®ÿ±", en:"Al-Mutakabbir"}];
        const quizBank = [{q:"Who is the first Prophet?", a:["Adam (AS)","Nuh (AS)","Idris (AS)"], c:0}, {q:"How many Rakats in Fajr Fard?", a:["4","2","3"], c:1}];
        const wisdoms = ["Indeed, with hardship comes ease (94:6).", "The best among you are those who learn the Quran and teach it.", "So remember Me; I will remember you (2:152)."];

        function save() { 
            localStorage.setItem('alsa_v10', JSON.stringify(userData));
            document.getElementById('coinCount').innerText = userData.coins;
            const user = auth.currentUser;
            if (user) db.ref('leaderboard/' + user.uid).set({ name: user.displayName, coins: userData.coins, lastUpdated: firebase.database.ServerValue.TIMESTAMP });
        }
        function countTasbih() {
            userData.tasbih++;
            if (navigator.vibrate) navigator.vibrate(20);
            if(userData.tasbih % 33 === 0) { userData.coins += 1; showCoinAnimation(); }
            document.getElementById('tasbihDisplay').innerText = userData.tasbih;
            save();
        }
        function resetTasbih() { userData.tasbih = 0; document.getElementById('tasbihDisplay').innerText = 0; save(); }
        function openTasbih() { toggleMenu(); const p = document.getElementById('tasbihPanel'); p.style.display = 'flex'; setTimeout(() => p.classList.add('panel-active'), 10); }
        function closeTasbih() { const p = document.getElementById('tasbihPanel'); p.classList.remove('panel-active'); setTimeout(() => p.style.display = 'none', 400); }
        async function fetchPrayerTimes() {
            try {
                const pos = await new Promise((res, rej) => navigator.geolocation.getCurrentPosition(res, rej));
                const res = await fetch(`https://api.aladhan.com/v1/timings?latitude=${pos.coords.latitude}&longitude=${pos.coords.longitude}&method=2`);
                const data = await res.json();
                const times = data.data.timings;
                document.getElementById('t-fajr').innerText = times.Fajr; document.getElementById('t-dhuhr').innerText = times.Dhuhr; document.getElementById('t-asr').innerText = times.Asr; document.getElementById('t-maghrib').innerText = times.Maghrib; document.getElementById('t-isha').innerText = times.Isha; document.getElementById('t-sunrise').innerText = times.Sunrise;
                document.getElementById('locationLabel').innerText = "Prayer Times (Live)";
            } catch (e) { document.getElementById('locationLabel').innerText = "Prayer Times (Default)"; }
        }
        function handleGoogleLogin() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider).then((result) => {
                db.ref('leaderboard/' + result.user.uid).once('value').then((snapshot) => { if (snapshot.exists()) { userData.coins = snapshot.val().coins || 0; save(); } });
                updateUI(result.user);
            });
        }
        function handleLogout() { auth.signOut().then(() => updateUI(null)); }
        function updateUI(user) {
            const nameEl = document.getElementById('userNameDisplay');
            const loginBtn = document.getElementById('loginBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            if (user) { nameEl.innerText = "SALAM, " + user.displayName; loginBtn.style.display = "none"; logoutBtn.style.display = "block"; save(); }
            else { nameEl.innerText = ""; loginBtn.style.display = "flex"; logoutBtn.style.display = "none"; }
            renderLeaderboard();
        }
        auth.onAuthStateChanged(updateUI);
        function completeSalah(id, btn) { if(userData.claimedSalah.includes(id)) return; userData.coins += 1; userData.claimedSalah.push(id); btn.classList.add('done'); showCoinAnimation(); save(); }
        function showCoinAnimation() { const el = document.getElementById('coinFeedback'); el.classList.remove('animate-coin'); void el.offsetWidth; el.classList.add('animate-coin'); }
        function renderLeaderboard() {
            const lbBody = document.getElementById('leaderboardBody');
            db.ref('leaderboard').orderByChild('coins').limitToLast(10).on('value', (snapshot) => {
                let leaders = []; snapshot.forEach((child) => { leaders.push(child.val()); }); leaders.reverse();
                lbBody.innerHTML = leaders.map((leader, index) => `<tr><td class="rank">#${index + 1}</td><td>${leader.name || "Anonymous"}</td><td style="text-align:right">${(leader.coins || 0).toLocaleString()} ü™ô</td></tr>`).join('');
            });
        }
        window.onload = () => {
            fetchPrayerTimes(); renderLeaderboard();
            document.getElementById('tasbihDisplay').innerText = userData.tasbih;
            const sList = document.getElementById('surahList');
            for(let i=1; i<=50; i++) {
                let id = i.toString().padStart(3, '0');
                sList.innerHTML += `<div class="surah-card"><div class="surah-info"><b>${i}. ${surahNames[i-1]}</b><span class="surah-name-ar">ÿ≥Ÿàÿ±ÿ©</span></div><audio controls preload="none" src="https://server8.mp3quran.net/afs/${id}.mp3"></audio></div>`;
            }
            const qList = document.getElementById('quoteList');
            wisdoms.forEach((text, i) => { qList.innerHTML += `<div class="q-card"><p>"${text}"</p><span>‚Äî Wisdom #${i+1}</span></div>`; });
            const nGrid = document.getElementById('namesGrid');
            allahNames.forEach(n => { nGrid.innerHTML += `<div class="name-box"><span class="ar">${n.ar}</span><span class="en">${n.en}</span></div>`; });
            updateTimers(); setInterval(updateTimers, 60000);
        };
        function loadNewQuestion() {
            const rand = quizBank[Math.floor(Math.random() * quizBank.length)];
            document.getElementById('questionText').innerText = rand.q;
            const container = document.getElementById('optionsContainer'); container.innerHTML = "";
            rand.a.forEach((opt, i) => { container.innerHTML += `<button class="quiz-opt" onclick="checkQuiz(${i}, ${rand.c}, this)">${opt}</button>`; });
        }
        function checkQuiz(choice, correct, btn) {
            if(choice === correct) { btn.style.background = "#34c759"; btn.style.color = "white"; userData.coins += 1; showCoinAnimation(); save(); setTimeout(loadNewQuestion, 800); }
            else { btn.style.background = "#ff3b30"; btn.style.color = "white"; setTimeout(() => { btn.style.background = "#f8f9fb"; btn.style.color = "var(--emerald)"; }, 500); }
        }
        function toggleMenu() { 
            let m = document.getElementById('fullMenu'); 
            if(m.style.display === 'flex') { m.classList.remove('panel-active'); setTimeout(() => m.style.display = 'none', 400); }
            else { m.style.display = 'flex'; setTimeout(() => m.classList.add('panel-active'), 10); }
        }
        function openSurahs() { toggleMenu(); const p = document.getElementById('surahPanel'); p.style.display = 'flex'; setTimeout(() => p.classList.add('panel-active'), 10); }
        function closeSurahs() { const p = document.getElementById('surahPanel'); p.classList.remove('panel-active'); setTimeout(() => p.style.display = 'none', 400); }
        function openQuiz() { const p = document.getElementById('quizPanel'); p.style.display = 'flex'; loadNewQuestion(); setTimeout(() => p.classList.add('panel-active'), 10); }
        function closeQuiz() { const p = document.getElementById('quizPanel'); p.classList.remove('panel-active'); setTimeout(() => p.style.display = 'none', 400); }
        function updateTimers() {
            const now = new Date();
            const ram = new Date("Feb 18, 2026 00:00:00").getTime();
            const dR = ram - now.getTime();
            document.getElementById('ramadan').innerText = Math.max(0, Math.floor(dR/(1000*60*60*24))) + "d " + Math.max(0, Math.floor((dR%(1000*60*60*24))/(1000*60*60))) + "h";
        }
    </script>
</body>
</html>
